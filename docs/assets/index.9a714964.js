var z=Object.defineProperty;var S=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var y=(n,e,i)=>e in n?z(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,g=(n,e)=>{for(var i in e||(e={}))C.call(e,i)&&y(n,i,e[i]);if(S)for(var i of S(e))b.call(e,i)&&y(n,i,e[i]);return n};import{r as c,N as w,n as o,m as x,d as _,R as a,a as $,b as R,B as E,c as f,e as N,f as k,T as O,g as A,C as v,h as I,E as q}from"./vendor.076bc464.js";const B=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function i(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerpolicy&&(r.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?r.credentials="include":t.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(t){if(t.ep)return;t.ep=!0;const r=i(t);fetch(t.href,r)}};B();const F="react-ant-abstract-curd";class d extends c.exports.Component{constructor(e){super(e);this.urlOperator=new w({type:"hash"}),this.resources="users",this.rowKey="id",this.size="small",this.bordered=!0,this.current={item:null,index:-1},this.module="modules",this.action="index",this.searchable=!1,this.pagination={page:"page",size:"size",total:"total"},this.route=(s,t)=>{const r=`/${this.module}/${this.resources}/${s}`,h=t?"replace":"push";this.routeService[h](r)},this.add=()=>{this.routeService.push(`/${this.module}/${this.resources}/add`)},this.edit=()=>{this.routeService.push(`/${this.module}/${this.resources}/edit/${this.id}`)},this.del=()=>{const s=o.mix(null,this.current.item,this.options);this.apiService[`${this.resources}_destroy`](s).then(()=>this.refresh())},this.update=s=>{const t=g({id:this.id},s);this.apiService[`${this.resources}_update`](t).then(()=>x.success("\u64CD\u4F5C\u6210\u529F"))},this.refresh=()=>{const{page:s,size:t}=this.pagination;this.load({[s]:this.state[s],[t]:this.pageSize})},this.forceRefresh=()=>{this.keywords="",this.handleTableChange({current:1,pageSize:this.pageSize})},this.load=_((s,t)=>{const r=t||this.action||"index",{size:h}=this.pagination,u=o.mix({[h]:this.pageSize},s,this.options);this.setState({loading:!0}),this.apiService[`${this.resources}_${r}`](u).then(l=>{const{rows:p,total:m}=this.setResponse(l);this.setState({data:p,total:m,loading:!1})})}),this.handleQuery=s=>{const{value:t}=s.target;this.keywords=t,this.handleTableChange({current:1,pageSize:this.pageSize})},this.handleTableChange=s=>{const{current:t,pageSize:r}=s,{page:h,size:u}=this.pagination,l={[h]:t,[u]:r};this.page=t,this.pageSize=r,this.setState(l,()=>{this.load(l)})};const{total:i}=this.pagination;this.lastQs=this.qs,this.state=o.mix(null,this.initialState(),{loading:!1,columns:this.columns,data:[],[i]:0}),this.init()}get options(){return{}}get keywords(){const{keywords:e}=this.qs;return e||""}set keywords(e){location.href=this.urlOperator.update({keywords:e})}get page(){const{page:e}=this.qs;return e||1}set page(e){location.href=this.urlOperator.update({page:e})}get pageSize(){const{size:e}=this.qs;return e||10}set pageSize(e){location.href=this.urlOperator.update({size:e})}get id(){return o.get(this.current,`item.${this.rowKey}`)}get fields(){return[]}get actions(){return{title:"\u64CD\u4F5C",width:90,render:()=>a.createElement("span",{className:"mr-5_ mr_ is-actions"},a.createElement("a",{onClick:this.edit},"\u7F16\u8F91"),a.createElement($,{onClick:this.del},"\u5220\u9664"))}}get columns(){return this.actions?this.fields.concat(this.actions):this.fields}get extraView(){return a.createElement("div",{className:"mr-5_ is-extra"},this.searchable&&a.createElement(R,{placeholder:`\u6309title\u641C\u7D22${this.resources}`,allowClear:!0,autoFocus:!0,size:"small",defaultValue:this.keywords,enterButton:!0,onSearch:this.handleQuery}),a.createElement(E,{size:"small",onClick:this.forceRefresh,className:"mr-5_ mr_"},a.createElement(f,{value:"refresh",size:14}),a.createElement("span",null,"\u5237\u65B0")),a.createElement(E,{size:"small",onClick:this.add,className:"mr-5_ mr_"},a.createElement(f,{value:"addition",size:14}),a.createElement("span",null,"\u65B0\u589E")))}get params(){return o.get(this.props,"match.params")}get qs(){const e=location.hash.slice(1);if(!e)return{};const[i,s]=e.split("?");return N(s)}initialState(){return null}setResponse(e){return e}init(){}initCache(){const{page:e,size:i,total:s}=this.pagination;this.state=Object.assign(this.state,{[e]:this.page,[i]:this.pageSize,[s]:0})}componentDidMount(){const{page:e}=this.pagination;this.attachEvents(),this.initCache(),this.load({[e]:this.state[e]}),setTimeout(()=>{o.set(this.routeService,"current",this.props)},0)}shouldComponentUpdate(){return k(this.qs,this.lastQs)||(this.lastQs=this.qs,this.refresh()),!0}componentWillUnmount(){this.detachEvents()}attachEvents(){this.refreshEvent=this.eventService.on(`${this.resources}.${this.action}.refresh`,()=>{this.refresh()})}detachEvents(){this.refreshEvent&&this.refreshEvent.destroy()}table(e){const i=e||{},{columns:s,data:t,total:r,loading:h}=this.state,{page:u,size:l}=this.pagination;return a.createElement(O,g({loading:h,size:this.size,bordered:this.bordered,columns:s,dataSource:t,onChange:this.handleTableChange,rowKey:this.rowKey,onRow:(p,m)=>({onMouseEnter:()=>{this.current={index:m,item:p}}}),pagination:{showSizeChanger:!0,total:r,pageSize:parseInt(this.state[l]),current:parseInt(this.state[u])}},i))}empty(){return a.createElement(A,{centered:!0,title:"\u6682\u65E0\u6570\u636E"})}view(){const{data:e}=this.state;return a.createElement(v,{title:"\u5217\u8868"},e.length?this.table():this.empty())}render(){return null}}d.displayName=F;d.version="__VERSION__";d.defaultProps={};class T{static repos_index(e){var i=o.param(e,"https://jsonplaceholder.typicode.com/posts");return fetch(i).then(s=>s.json())}static repos_destroy(e){return new Promise(i=>{console.log("call destroy api",e),i(e)})}}class L{static push(e){console.log("push to:",e)}}class V extends d{constructor(){super(...arguments);this.apiService=T,this.routeService=L,this.eventService=o.mix(this,q),this.resources="repos",this.searchable=!0,this.pagination={page:"page",size:"per_page",total:"total"}}get fields(){return[o.antColumn("ID","id"),o.antColumn("title","title"),o.antColumn("body","body",e=>String(e)),o.antColumn("uid","userId")]}setResponse(e){return{rows:e,total:100}}get titleView(){return c.exports.createElement("span",{className:"mr-5_ mr_"},c.exports.createElement(f,{value:"date"}),c.exports.createElement("span",null,"\u5217\u8868\u7BA1\u7406"))}render(){return c.exports.createElement(v,{title:this.titleView,className:"m10 react-ant-abstract-curd",extra:this.extraView},this.table())}}I.exports.render(c.exports.createElement(V,null),document.getElementById("root"));
